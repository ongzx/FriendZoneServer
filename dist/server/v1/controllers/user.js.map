{"version":3,"sources":["server/v1/controllers/user.js"],"names":["list","req","res","next","findAll","then","json","users","catch","error","extractEmails","text","match","findFriends","email","body","currentUuid","waterfall","callback","findOne","where","user","err","message","uuid","$or","userUuid","like","friendUuid","status","friends","map","combinedUuid","concat","combinedUuidExcludedSelf","remove","elem","$in","results","send","success","count","length","addFriend","friendsEmail","findOrCreate","defaults","following","friendship","update","result","commonFriends","friend","getFriend","user1Friends","user2Friends","intersectionBy","filter","Friendship","subscribe","requestor","target","blockUser","findRecipients","sender","mentionedEmail","senderUuid","$notLike","recipients"],"mappings":"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","file":"user.js","sourceRoot":"../../../../../../.."}